# Installation

## Install R libraries
Open Rstudio and run the following in the console
install.packages("here", repos = 'http://cran.rstudio.com/')

## Create an R project
Open RStudio and click "New Project" on the top right to create an R project in the "mapping" directory. The "mapping.Rproj" file will be created in the "mapping" directory


# Plotting profiles using R scripts
1. Create a "DATASETNAME" directory in mapping/matrix.Rdata/ and copy matrix.Rdata and rpm.txt files generated by a mapping script to mapping/matrix.Rdata/DATASETNAME. DATASETNAME will be used to make output file names. If there is one replicate, DATASETNAME can be the same as NAME specified in a mapping script. If there are replicates of "wt" samples, "wt1", and "wt2", for example, matrix.Rdata and rpm.txt files of "wt1" and "wt2" can be stored together in mapping/matrix.Rdata/wt. The "wt1" and "wt2" data will be averaged and output file names will contain "wt". If the "PROJECT", "NAME" and "GENOME" in the mapping script are set as "Project_XXX", "NAME" and "mm10", respectively, the following matrix.Rdata and rpm.txt files are stored in mapping/Project_XXX/mm10/NAME/.
- hotspot.center.SPO11.B6.Cell.mmc2.bed.NAME.F.halfwin.5600.matrix.Rdata
- hotspot.center.SPO11.B6.Cell.mmc2.bed.NAME.R.halfwin.5600.matrix.Rdata
- NAME.rpm.txt
2. Duplicate an R script in /mapping/scripts/MouseResection/main/R/ and rename the file such as "20240711_1_mean.profiles.around.SPO11-oligo.hotspot.centers_wt.R".
3. Open RStudio and select "Open Project" on the top right to select "mapping.Rproj" in the "mapping" directory.
4. Open "20240711_1_mean.profiles.around.SPO11-oligo.hotspot.centers_wt.R" in RStudio and modify the "workdir" and "sample.names" variables. The "workdir" variable specifies a path to a directory where outputs of the R script will be saved. The "sample.names" specifies "NAME" or the sample name(s) of matrix.Rdata file(s). If multiple NAMEs are set as a character vector, samples will be averaged. (Option) Modify other variables such as those to set threshold values to optimize the script to analyze samples of interest.
5. Run the script in Rstudo and modify variables such as threshold if necessary. Output PDF files can be further edited in illustrator.


# Outputs
The mapping/R/ directory is for storing outputs of R analyses. Outputs of the following R scripts are described below.

## mean.profiles.around.SPO11-oligo.hotspot.centers.R
- Average profiles of reads (read per million mapped reads, RPM) around SPO11-oligo hotspots. Top and bottom strand reads are cooriented and averaged, and signal is smoothed with a 151-bp Hann window. 

## heatmaps.around.SPO11-oligo.hotspot.centers.R
Heatmaps of top strand and bottom strand signal around SPO11-oligo hotspots. Each line represents a SPO11-oligo hotspot (n = 13,960), strongest at the top. Sequencing signals (in 40-bp bins) are locally normalized by dividing by the total signal in a 4001-bp window around each hotspot’s center. Each hotspot thus has a total value of 1, so that spatial patterns can be compared between hotspots of different strengths.

## resection.tract.histogram.mean.resection.length.and.normalized.mean.profiles.R
- Histograms of resection tract lengths. Average profiles around SPO11-oligo hotspots are binned every 100 bp. An estimated background is removed by subtracting from all values the value of signal 2.5 kb away from the hot spot center. The signal close to and further away from the hot spot center is excluded by setting values of positions <100 bp and >2.5 kb to zero. Fractions of total signal are calculated every 100 bp and plotted and the mean resection lengths are calculated. 
- Parameters used for generating resection tract length histograms, mean resection tract lengths and other statistics of mean profiles are written in a text file.
- Normalized profiles of reads around SPO11-oligo hotspots. Smoothed average profiles are normalized to set the height of the resection peak as 1 after subtracting background defined as the signal 2.5 kb away from the hotspot center. Negative values after background subtraction are set as zero for plotting purposes.

## scatter.plot.comparing.SPO11-oligo.and.S1-seq.heat.R
Correlation of read count with DSB intensity measured by SPO11-oligo sequencing. Each point is a SPO11-oligo hotspot, with signal summed from −2000 to −250 bp (bottom strand) and +250 to +2000 bp (top strand) around hotspot centers. SPO11-oligo signal is summed in 2001-bp windows around hotspot centers. Hotspots with no read counts are excluded for Pearson's r calculation. Hotspots with ≤0.01 RPM are set as 0.01 for plotting purposes. 

## scatter.plot.checking.reproducibility.between.maps.R
Scatter plots comparing two maps. Each point is a SPO11-oligo hotspot, with S1-seq signal summed from −2000 to −250 bp (bottom strand) and +250 to +2000 bp (top strand) relative to the hotspot center. Hotspots with no signal (0 RPM) are excluded for Pearson’s r calculation between the two maps. Hotspots with ≤0.01 RPM are set as 0.01 for plotting purposes. 
